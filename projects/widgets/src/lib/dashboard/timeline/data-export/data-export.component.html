<main hyt-dialog>
  <section i18n="@@HYT_export_data" hyt-dialog-header>Export Data</section>

  <section class="dialog-form-content" hyt-dialog-content>
    <form [formGroup]="form" class="container">
      <div class="row row-cols-2">
        <div class="d-flex flex-column p-2">
          <mat-form-field appearance="fill">
            <mat-label>Start Time</mat-label>
            <input
              matInput
              [ngxMatDatetimePicker]="startTimePicker"
              placeholder="Choose a date"
              (click)="startTimePicker.open()"
              formControlName="startTime"
              readonly
              required
            />
            <mat-datepicker-toggle matSuffix [for]="$any(startTimePicker)">
            </mat-datepicker-toggle>
            <ngx-mat-datetime-picker #startTimePicker [showSeconds]="true">
            </ngx-mat-datetime-picker>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Select Export Format</mat-label>
            <mat-select formControlName="hPacketFormat" required>
              <mat-option
                *ngFor="let hPacketFormat of hPacketFormatEnum | keyvalue"
                [value]="hPacketFormat.value"
              >
                {{ hPacketFormat.value }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-chip-list
            #first="cdkDropList"
            cdkDropList
            cdkDropListOrientation="horizontal"
            [cdkDropListData]="hPacketList"
            [cdkDropListConnectedTo]="[last]"
            (cdkDropListDropped)="drop($event)"
            cdkDropListSortingDisabled
            class="wrapper"
          >
            <mat-chip
              class="example-box"
              cdkDrag
              (click)="moveElementToLeft(hPacket)"
              *ngFor="let hPacket of hPacketList"
            >
              {{ hPacket.name }}
            </mat-chip>
          </mat-chip-list>
        </div>

        <div class="d-flex flex-column p-2">
          <mat-form-field appearance="fill">
            <mat-label>End Time</mat-label>
            <input
              matInput
              [ngxMatDatetimePicker]="endTimePicker"
              placeholder="Choose a date"
              (click)="endTimePicker.open()"
              formControlName="endTime"
              readonly
              required
            />
            <mat-datepicker-toggle matSuffix [for]="$any(endTimePicker)">
            </mat-datepicker-toggle>
            <ngx-mat-datetime-picker #endTimePicker [showSeconds]="true">
            </ngx-mat-datetime-picker>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Export Name</mat-label>
            <input
              matInput
              formControlName="exportName"
              [maxlength]="maxLength"
              required
            />
          </mat-form-field>

          <mat-chip-list
            #last="cdkDropList"
            cdkDropList
            cdkDropListOrientation="horizontal"
            [cdkDropListData]="hPacketListSelected"
            [cdkDropListConnectedTo]="[first]"
            (cdkDropListDropped)="drop($event)"
            cdkDropListSortingDisabled
            class="wrapper"
          >
            <mat-chip
              class="example-box"
              cdkDrag
              (click)="moveElementToRight(hPacket)"
              *ngFor="let hPacket of hPacketListSelected"
            >
              {{ hPacket.name }}
            </mat-chip>
          </mat-chip-list>
        </div>
      </div>

      <div class="d-flex flex-column">
        <p *ngFor="let error of exportErrorList">
          Si Ã¨ verificato un errore durante il download del packet
          {{ error.hPacketId }}
        </p>

        <button
          class="hyt-base-btn mat-hyt-base-total-blue mat-raised-button"
          type="button"
          (click)="resetForm()"
        >
          Reset
        </button>
      </div>
    </form>
  </section>

  <section class="dialog-footer" hyt-dialog-footer>
    <hyt-button
      class="button-confirm"
      [isDisabled]="form.invalid || hPacketListSelected.length <= 0"
      [color]="'hyt-base-default-white'"
      (clickFn)="export()"
    >
      <mat-icon>check</mat-icon>
      <span i18n="@@HYT_export">Export</span>
    </hyt-button>

    <hyt-button
      class="button-close"
      [color]="'hyt-base-default-white'"
      (clickFn)="closeModal($event)"
    >
      <mat-icon>close</mat-icon>
      <span i18n="@@HYT_cancel">Cancel</span>
    </hyt-button>
  </section>
</main>
