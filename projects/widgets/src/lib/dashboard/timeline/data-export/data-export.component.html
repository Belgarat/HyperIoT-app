<main hyt-dialog>
  <section i18n="@@HYT_export_data" hyt-dialog-header>Export Data</section>

  <section class="dialog-form-content" hyt-dialog-content>
    <form [formGroup]="form" class="container">
      <div class="row row-cols-2">
        <div class="d-flex flex-column p-2">
          <mat-form-field appearance="fill">
            <mat-label>Start Time</mat-label>
            <input
              matInput
              [ngxMatDatetimePicker]="startTimePicker"
              placeholder="Choose a date"
              (click)="startTimePicker.open()"
              formControlName="startTime"
              readonly
              required
            />
            <mat-datepicker-toggle matSuffix [for]="$any(startTimePicker)">
            </mat-datepicker-toggle>
            <ngx-mat-datetime-picker #startTimePicker [showSeconds]="true">
            </ngx-mat-datetime-picker>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Select Export Format</mat-label>
            <mat-select formControlName="hPacketFormat">
              <mat-option [value]="hPacketFormatEnum.JSON">
                {{ hPacketFormatEnum.JSON }}
              </mat-option>
              <mat-option [value]="hPacketFormatEnum.CSV">
                {{ hPacketFormatEnum.CSV }}
              </mat-option>
              <mat-option [value]="hPacketFormatEnum.TEXT" disabled>
                {{ hPacketFormatEnum.TEXT }}
              </mat-option>
              <mat-option [value]="hPacketFormatEnum.XML" disabled>
                {{ hPacketFormatEnum.XML }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <hyt-select
            #selectPackets
            class="hyt-select-full-width"
            [name]="'packetSelect'"
            [label]="'Select one or more Packets'"
            [groups]="hPacketListSelectOption"
            [isSearchable]="true"
            (valueFn)="addPacketSelectedList($event)"
            [isRequired]="true"
            [errorMsgRequired]="'Select one or more Packets'"
          >
          </hyt-select>
        </div>

        <div class="d-flex flex-column p-2">
          <mat-form-field appearance="fill">
            <mat-label>End Time</mat-label>
            <input
              matInput
              [ngxMatDatetimePicker]="endTimePicker"
              placeholder="Choose a date"
              (click)="endTimePicker.open()"
              formControlName="endTime"
              required
              readonly
              [min]="startTime.value"
            />
            <mat-datepicker-toggle matSuffix [for]="$any(endTimePicker)">
            </mat-datepicker-toggle>
            <ngx-mat-datetime-picker #endTimePicker [showSeconds]="true">
            </ngx-mat-datetime-picker>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Export Name</mat-label>
            <input
              matInput
              formControlName="exportName"
              name="exportName"
              [maxlength]="maxLength"
              required
            />
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>
              Selected {{ hPacketListSelected.length }} packages
            </mat-label>
            <mat-chip-list class="mat-chip-list-wrapper">
              <mat-chip
                *ngFor="let hPacket of hPacketListSelected"
                class="mat-chip-custom"
                (removed)="removeHPacket(hPacket)"
              >
                {{ hPacket.name }}
                <button matChipRemove>
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip>
            </mat-chip-list>
          </mat-form-field>
        </div>
      </div>

      <div *ngIf="exportErrorList.length" class="py-2">
        <mat-error *ngFor="let error of exportErrorList">
          Si Ã¨ verificato un errore durante il download del packet
          {{ error.hPacketId }} con id {{ error.exportId }}
        </mat-error>
      </div>

      <div class="d-flex justify-content-end">
        <button
          class="hyt-base-btn mat-hyt-base-total-blue mat-raised-button"
          type="button"
          (click)="resetForm()"
        >
          Reset
        </button>
      </div>
    </form>
  </section>

  <section class="dialog-footer" hyt-dialog-footer>
    <hyt-button
      class="button-confirm"
      [isDisabled]="form.invalid || hPacketListSelected.length <= 0"
      [color]="'hyt-base-default-white'"
      (clickFn)="export()"
    >
      <mat-icon>check</mat-icon>
      <span i18n="@@HYT_export">Export</span>
    </hyt-button>

    <hyt-button
      class="button-close"
      [color]="'hyt-base-default-white'"
      (clickFn)="closeModal($event)"
    >
      <mat-icon>close</mat-icon>
      <span i18n="@@HYT_cancel">Cancel</span>
    </hyt-button>
  </section>
</main>
